# 事件

## 事件处理

故障无感知的有状态的工作流可以被接收外部事件的信号。信号总是点对点地指向特定工作流实例。信号始终按照接收顺序进行处理。

信号可以用于很多种场景。

## 事件汇总和关联

Temporal 不能替代 Apache Flink 或 Apache Spark 等通用流处理引擎。但是在某些情况下它更合适，例如当所有应该聚合和关联的事件始终应用于具有清晰 ID 的某个业务实体时。此时只要特定条件满足时操作就会被执行。

一个主要限制是单个 Temporal 工作流的吞吐量非常有限，而工作流的数量实际上是无限的。因此如果您需要对每个客户汇总事件，并且您的应用程序拥有1亿客户，每个客户每秒生成的事件不超过20个，那么 Temporal 可以正常工作。但是如果您想汇总美国客户的所有事件，那么这些事件的产生频率将超出单个工作流的能力。

例如，物联网设备生成事件并且用有一定顺序的事件来表明应重新配置该设备。每个设备都将创建工作流实例，并且每个实例将管理设备的状态机并在必要时执行重新配置活动。

另一个用例是客户忠诚度计划。每次客户购买商品时都会生成一个事件进入 Apache Kafka 供下游系统处理。忠诚度服务的 Kafka 消费者接收该事件，并使用 Temporal `signalWorkflowExecution`API 向客户工作流发出有关购买的信号。工作流会累计购买次数。如果达到了指定的阈值，则工作流将执行一项活动，以通知某些外部服务客户已达到下一级别的忠诚度计划。工作流还执行活动以定期向客户发送有关其当前状态的消息。

## 人工任务

许多业务流程都涉及人工参与者。Temporal 用于实现外部交互的标准模式是执行在外部系统中创建人工任务的活动。它可以是带有表单的电子邮件，也可以是某些外部数据库中的记录，也可以是移动应用通知。当用户更改任务状态时，信号将发送到相应的工作流。比如表单提交或移动应用通知被确认。一些任务具有多种可能的动作，例如索赔，退货，完成，拒绝。这中情况下就可以发送多个信号。

## 流程执行变更

某些业务流程在发生了某些外部事件时应更改其行为。例如在执行订单运送工作流时，任何物品数量的变化都可以以信号的形式传递。

另一个示例是服务部署工作流。在向 Kubernetes 集群推出新软件版本时发现了一些问题。在调查问题时，可以使用信号来要求工作流暂停。然后可以使用继续信号或回滚信号来执行适当的操作。

## 同步

Temporal 工作流是高度一致的，因此它们可以用作执行中活动的同步点。例如要求顺序处理单个用户的所有消息，但是底层消息传递基础结构可以并行传递它们。Temporal 解决方案将是为每个用户提供一个工作流，并在收到事件时向其发出信号。然后，工作流将所有信号缓存在内部数据结构中，然后为收到的每个信号调用一个活动。有关示例，请参见下面的[Stack Overflow答案](https://stackoverflow.com/a/56615120/1664318)。

